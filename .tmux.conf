# OS-specific config
if-shell "uname | grep -q Darwin" "source-file ~/.tmux-mac" "source-file ~/.tmux-linux"

# Plugins (TPM style)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-copycat'

# Modern terminal features
set -g default-terminal "tmux-256color"
set -as terminal-features "xterm-256color:RGB,ghostty:RGB"
set -as terminal-features "ghostty:clipboard"

# Clipboard + passthrough
set -g set-clipboard on
set -g allow-passthrough on

# vi copy-mode bindings
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi r send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Enter send -X copy-selection-and-cancel
# Reliable fallback to macOS clipboard:
bind -T copy-mode-vi Y send -X copy-pipe-and-cancel 'pbcopy'

# Status: show window name, not pane title
set -g window-status-format "#[fg=#11111b,bg=#{@thm_overlay_2}] #I #[fg=#cdd6f4,bg=#{@thm_surface_0}] #W "
set -g window-status-current-format "#[fg=#11111b,bg=#{@thm_mauve}] #I #[fg=#cdd6f4,bg=#{@thm_surface_1}] #W "

# Keep manual names stable (optional, recommended)
set -g automatic-rename off
set -g allow-rename off

# Pane border and status
set -g pane-border-status bottom
set -g pane-border-format ' #{pane_index} #{pane_title} '

# Splits (preserve current directory)
bind | split-window -hc '#{pane_current_path}'
bind - split-window -vc '#{pane_current_path}'
unbind '"'
unbind %

# Start windows and panes at 1
set -g base-index 1
setw -g pane-base-index 1

# Sync mode toggle, kill other panes
bind S setw synchronize-panes
bind k kill-pane -a

# Theme + prefix highlight
set -g @theme-status-left '#{prefix_highlight}'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_sync_mode_attr 'fg=black,bg=green'
set -g @catppuccin_flavour 'mocha'
set -g @catppuccin_window_status_enable 'yes'
set -g @catppuccin_window_status_icon_enable 'yes'
set -g @catppuccin_window_left_separator 'â–ˆ'
set -g @catppuccin_status_modules_right ''

# History + persistence
set -g history-limit 100000
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'

set -g display-panes-time 2000

# TPM bootstrap
run -b '~/.tmux/plugins/tpm/tpm'
